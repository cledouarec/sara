---
id: "ADR-001"
type: architecture_decision_record
name: "Hub-Based Hybrid Architecture"
description: >
  Decision to use a local hub-based architecture with cloud connectivity rather
  than a pure cloud-only or pure local-only approach.
status: accepted
deciders:
  - "Smart Home Architecture Team"
justifies:
  - "SYSARCH-COMM"
---

# Hub-Based Hybrid Architecture

## Context

The smart home system must balance several competing concerns:

- **Latency**: Users expect near-instant response to commands (< 500ms)
- **Reliability**: System must work even when internet connectivity is degraded
- **Privacy**: Some users prefer local-only data processing
- **Remote access**: Users want control when away from home
- **Scalability**: Architecture must support dozens of devices per home

We evaluated three architectural approaches:

- **Cloud-only**: All processing in the cloud, devices connect directly
- **Local-only**: All processing on a local hub, no cloud connectivity
- **Hybrid**: Local hub for real-time control, cloud for remote access and analytics

## Decision

Adopt a hub-based hybrid architecture where a central hub handles local device
communication and real-time control, while cloud services provide remote access,
push notifications, and analytics.

## Rationale

1. **Latency requirements**: Local hub enables sub-100ms command execution
   without round-trip to cloud, meeting the <500ms requirement even with margin

2. **Offline resilience**: Core functionality (lights, basic automations)
   continues working during internet outages

3. **Privacy by design**: Sensitive data (motion patterns, presence detection)
   can be processed locally without leaving the home network

4. **Remote access**: Cloud gateway enables secure remote control when users
   are away from home

5. **Firmware updates**: Cloud connectivity allows OTA updates for hub and
   devices while maintaining local control during updates

6. **Alert delivery**: Cloud services enable push notifications to mobile
   devices via FCM/APNs, meeting the 30-second alert requirement

## Consequences

### Positive

- Fast, responsive local control regardless of internet quality
- System remains functional during internet outages
- User privacy preserved for local operations
- Secure remote access when needed
- Flexible deployment (local-only mode available for privacy-conscious users)

### Negative

- Higher hardware cost (hub required vs. cloud-only approach)
- More complex system topology to maintain
- Hub becomes critical component requiring reliability engineering
- Synchronization complexity between local and cloud state

### Risks

- Hub hardware failure impacts all local devices (mitigated by cloud fallback
  for critical alerts)
- Security attack surface includes both hub and cloud (mitigated by defense
  in depth strategy)

## Alternatives Considered

### Cloud-Only Architecture

Rejected due to latency concerns and reliability issues during internet outages.
While simpler to deploy, the user experience degradation during connectivity
issues was unacceptable for a home control system.

### Local-Only Architecture

Rejected because it prevents remote access and push notifications. Users
strongly prefer being able to check on their home and receive alerts when away.

### Mesh Without Hub

Considered a peer-to-peer mesh where devices communicate directly. Rejected due
to complexity of maintaining consistent state across devices and difficulty
implementing automations without a central coordinator.
